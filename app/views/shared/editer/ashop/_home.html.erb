

<%= stylesheet_link_tag "creater/ashop/home", :media => "all" %>
<%= javascript_include_tag "ashops" %>
<%= javascript_include_tag "modal" %>

<%= form_for($ashop, :url => {:action => "create"}, :html => {:multipart => true}) do |form| %>

  <% if ashop.errors.any? %>

    <div id="error_explanation">

      <h2><%= pluralize(ashop.errors.count, "error") %> prohibited this ashop from being saved:</h2>

          <ul>
            <% ashop.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
          
    </div>
    
  <% end %>

        <div class="section" id="page">

            <h1>ホーム画面を編集する</h1>

                <div id="field">
                    <%= form.label :shopname do %><label for="labelx">:*店名 (必入力)</label><% end %><br>
                    <%= form.text_field :shopname, placeholder: '喫茶エフナイン' %>
                </div>

                <div id="field">
                    <%= form.label :top_id do %><label for="labelx">:*エリア (必入力)</label><% end %><br>
                    <%= form.collection_select :top_id, Top.order(:name), :id, :name, include_blank: true, :prompt => "選択してください" %>
                </div>

                <div id="field">
                    <%= form.label :area_id do %><label for="labelx">:*県 (必入力)</label><% end %><br>
                    <%= form.grouped_collection_select :area_id, Top.order(:name), :areas, :name, :id, :name, include_blank: true, :prompt => "選択してください" %>
                </div>

                <div id="field">
                    <%= form.label :prefec_id do %><label for="labelx">:*市町村 (必入力)</label><% end %><br>
                    <%= form.grouped_collection_select :prefec_id, Area.order(:name), :prefecs, :name, :id, :name, include_blank: true, :prompt => "選択してください" %>
                </div>

                <div id="field">
                    <%= form.label :acategory_id do %><label for="labelx">:グルメカテゴリー (必入力)</label><% end %><br>
                    <%= form.collection_select :acategory_id, Acategory.order(:name), :id, :name, include_blank: true, :prompt => "選択してください" %>
                </div>

                <div id="field">
                    <%= form.collection_select :category2, Acategory.order(:name), :id, :name, include_blank: true, :prompt => "選択してください" %>
                </div>
                
                <div id="field">
                    <%= form.collection_select :category3, Acategory.order(:name), :id, :name, include_blank: true, :prompt => "選択してください" %>
                </div>

                <div id="field-pic">

                          <%= form.label :topimage do %><label for="labelx">:トップ画像</label><% end %><br>

                          <label for="labely"><%= form.file_field :topimage, id: :shop_topimage , id: "file" %></label>

                          <p id="picdelete"><%= form.check_box :remove_topimage, seize: 30 %>画像を削除する</p>

                          <%= form.hidden_field :topimage_cache %><br>

                          <div id="thumb" onClick="$('#file').click()">
                            <% if ashop.topimage.present? %>
                              <div id="updimg"><%= image_tag ashop.topimage.to_s if $ashop.topimage? %></div> 
                            <% else %>
                              <div id="upimg"><%= image_tag("template/img") %></div>
                            <% end %>
                          </div>

                </div>
                  
                    <%= form.hidden_field :shopimage1_cache %>
                    <%= form.hidden_field :shopimage2_cache %>
                    <%= form.hidden_field :shopimage3_cache %>
                    
                <div id="actions"><%= form.submit(:決定) %></div>
                <%= link_to myashop_myashops_path do %><div id="eback">編集を中止する</div><% end %>

        </div>

<% end %>

<script>
    (function() {
  jQuery((function(_this) {
    return function() {
      var area;
      area = $('#ashop_area_id').html();
      console.log(area);
      return $('#ashop_top_id').change(function() {
        var options, top;
        top = $('#ashop_top_id :selected').text();
        options = $(area).filter("optgroup[label=" + top + "]").html();
        console.log(options);
        if (options) {
          return $('#ashop_area_id').html(options);
        } else {
          return $('#ashop_area_id').empty();
        }
      });
    };
  })(this));

}).call(this);

    (function() {
  jQuery((function(_this) {
    return function() {
      var prefec;
      prefec = $('#ashop_prefec_id').html();
      console.log(prefec);
      return $('#ashop_area_id').change(function() {
        var options, area;
        area = $('#ashop_area_id :selected').text();
        options = $(prefec).filter("optgroup[label=" + area + "]").html();
        console.log(options);
        if (options) {
          return $('#ashop_prefec_id').html(options);
        } else {
          return $('#ashop_prefec_id').empty();
        }
      });
    };
  })(this));

}).call(this);

</script>

<script>

$(function(){
  $fileField = $('#file')
 
  // 選択された画像を取得し表示
  $($fileField).on('change', $fileField, function(e) {
    file = e.target.files[0]
    reader = new FileReader(),
    $preview = $("#thumb");
 
    reader.onload = (function(file) {
      return function(e) {
        $preview.empty();
        $preview.append($('<img>').attr({
          src: e.target.result,
          width: "100%",
          class: "preview",
          title: file.name
        }));
      };
    })(file);
    reader.readAsDataURL(file);
  });
});

</script>